# PE Teacher App — 대화 기록 & 요약
- 생성 시각: 2026-02-14 09:54 UTC
- 대상 레포: `geunssam/pe-teacher-app`  
  - Repo: https://github.com/geunssam/pe-teacher-app

> 참고: 이 문서는 **사용자 메시지 + 현재 세션에서 확인 가능한 정보**를 기반으로 정리했습니다.  
> 시스템 상 일부 어시스턴트 메시지가 원문 그대로는 남아있지 않아, 해당 구간은 **‘요약 기반 재구성’** 형태로 기록했습니다.

---

## 1) 대화 로그 (요약 기반 재구성)

### 1. GitHub/레포 연동 가능 여부
- **User**: “혹시 깃헙 레포지토리랑 연동도 되니?”
- **Assistant(요지)**:  
  - 레포 링크를 주면 구조/코드 흐름을 읽고 리뷰할 수 있음.  
  - “자동 동기화/배포”는 GitHub Actions, Netlify/Firebase Hosting, Cloud Functions 같은 배포 파이프라인으로 구현 가능.

### 2. 레포 기반 코드 리뷰 + “수업스케치” RAG/벡터DB 문의
- **User**: https://github.com/geunssam/pe-teacher-app  
  “이 프로젝트로 코드 리뷰 및 구조를 한 번 살펴봐. 특히 수업스케치… 벡터 디비와 임베딩, RAG으로 챗봇… 파이어베이스에서 Genkit으로 할 수 있을까?”
- **Assistant(요지)**:  
  - 가능. 다만 **클라이언트(브라우저)에서 직접 벡터 검색을 돌리는 구조는 곤란**하고(보안·SDK 제약), 서버(Cloud Functions/Genkit flow)에서 처리하는 게 안정적.  
  - 앱의 “수업스케치”는 이미 **규칙 기반 모듈 조합(=컴파일)** 형태로 설계되어 있어, RAG는 이를 “대체”하기보다는 **지식 보강 + 설명/맞춤화 + 새로운 모듈 발굴**로 붙이는 게 베스트.

### 3. 수업스케치 기능 구체화(사용자 관점)
- **User 요지**:  
  - 체육 활동을 (1) FMS (기본 움직임) (2) 종목기술 (3) 규칙으로 분해 가능.  
  - 종목이 달라도 “교육과정 기반 FMS + 핵심 원리”가 같으면 활동을 응용/이식 가능.  
  - 예: 축구의 ‘대장패스’(차고-멈추기 기반)를 농구로 바꾸면 ‘대장 패스(던지고-받기)’가 됨.  
  - 핵심은 **활동 규칙의 뼈대는 유지**하고, **종목의 도구/기술(발/손, 패스 방식 등)만 바꾸는 것**.

- **Assistant(요지)**:  
  - “활동 모듈화 → 컴파일링” 접근이 매우 강력하다고 평가.  
  - 활동을 **Atom(핵심 뼈대)** + **Modifier(부수 규칙/미션/제약)** 로 분해하면,  
    - 한 종목에서 검증된 활동을 다른 종목으로 “이식”하는 게 체계화됨.  
  - LLM은 ‘발/손 바꾸기’ 같은 단순 변환만이 아니라,  
    - 학급 맥락(인원·실내·교구·안전·수준)까지 반영해 **현장 적용 가능한 버전**으로 정제하는 데 쓰는 게 진짜 가치.

### 4. 앞으로 해야 할 일(사용자 요청 1~5)
- **User**:  
  1) 학년별 FMS 구분  
  2) 종목별 FMS 분석 + 핵심 규칙 + 기술  
  3) 다양한 활동을 모듈화(활동끼리 셔플/융합)  
  4) 모듈식 체육 활동 구성안 예시  
  5) Firebase Genkit에 이식해서 벡터로 받고 LLM으로 추천/셔플 돌리기

- **Assistant(요지)**:  
  - 1~4는 “데이터 모델링”이 80%이고, 5는 “서버 아키텍처”가 80%.  
  - 먼저 **데이터 스키마**를 확정하고(Atom/Modifier/CoreRule/Template),  
  - 그 다음 RAG를 얹는 게 가장 빠르고 실패 확률이 낮음.

---

## 2) 레포 구조/코드 리뷰 (수업스케치 중심)

### 기술 스택/형태
- **React + Vite + Tailwind + React Router 기반 PWA** 구성 (PRD에도 명시)
- Netlify 배포(`netlify.toml`에서 `dist` publish, SPA redirect 설정)

### 페이지/정보 구조(코드 기준)
- `src/App.jsx` 라우팅:  
  - `HomePage`, `WeatherPage`, `SchedulePage`, `SketchPage`, `ClassesPage`, `SetupWizard`, `SettingsPage`
- “학급 설정이 안 되어 있으면 SetupWizard로” 이동시키는 `ProtectedRoute` 존재

### 학급/수업 기록 저장 방식(현재 구현)
- `useClassManager`가 **localStorage**로 학급/명단/기록을 관리(프로토타입 단계에 적합)
  - (향후 Firestore로 옮길 수 있도록 스키마 설계를 미리 잘 잡아둔 편)

### 수업스케치(현재 구현의 핵심 포인트)
- `SketchPage.jsx`가 3단계 UX:
  1) 조건 설정 → 2) 후보 확인 → 3) 수업 확정(기록 저장)
- 추천 엔진은 `useRecommend.js` + `generateCandidates.js` 기반
  - 현재 1차 범위는 **5~6학년 + 스포츠(전략형) + (축구/농구/피구/배구)** 중심으로 제한

### “모듈 컴파일”이 이미 들어가 있음 (여기가 진짜 핵심)
- 데이터가 이미 이렇게 나뉘어 있음:
  - `fmsTaxonomy.json` : 이동/비이동/조작 + 기술 목록 + 교육과정/학년군 포커스 메모
  - `sportCoreRules.json` : 종목 핵심 규칙/안전/금지 modifier 등 (추정: 데이터 파일)
  - `activityAtoms.json` : 활동의 핵심 뼈대(Atom) — “패스 후 침투”, “게이트 돌파 패스” 같은 것
  - `ruleModifiers.json` : 벌칙/미션/제약/규칙 변형(Modifier)
- `generateCandidates(request)`가 하는 일(요약):
  - (1) 조건에 맞는 Atom 풀을 고르고  
  - (2) 종목 CoreRule에 의해 허용된 Modifier 풀을 고른 다음  
  - (3) Atom + Modifier를 랜덤 조합해서 후보 3개를 뽑고(검증/스코어링 포함)  
  - (4) 제목/설명/운영팁 등을 자동 생성

> 결론(강한 의견):  
> 이미 **‘활동 컴파일러’**가 들어가 있어요.  
> 여기 위에 RAG를 올리면 “지식이 풍부해진 컴파일러 + 말 잘하는 설명가(챗봇)”가 됩니다.  
> 반대로, RAG/LLM만으로 추천을 뽑으면 현장 적용에서 쉽게 흔들립니다(안전/규칙/장비/시간 변수 때문에).

---

## 3) 수업스케치 기능을 “교육과정-기반 모듈 시스템”으로 확장하는 설계

### 3-1. 핵심 철학(선생님이 말한 걸 구조로 번역)
- **불변 조건(Invariants)**  
  - 교육과정 FMS(핵심 동작)  
  - 종목의 코어 룰(손/발/네트, 득점 방식, 반칙 등)  
  - 안전 규칙
- **가변 조건(Variants)**  
  - 게임 규칙/미션/벌칙/제약(터치 제한, 존, 시간제, 스쿼트, 얼음땡, 팀 교대 등)  
  - 인원/공간/도구/난이도/평가기준

즉, “대장패스”는 **Atom(대장/순환/패스 성공 미션 구조)**이고,  
축구/농구는 **CoreRule(발 패스/손 패스)** 차이로만 이식되는 구조로 보면 됩니다.

### 3-2. 데이터 모델(권장)
- `FMS` (taxonomy)
  - id, category, name, aliases, gradeFocus, curriculumLink
- `Sport` (core rules)
  - id, name, coreRules, safetyRules, forbiddenModifierIds, defaultEquipment, skillSet
- `Atom` (활동 뼈대)
  - id, name, compatibleSports, grades, fmsTags, sportSkillHints, basicRules, operationTips, baseDurationMin, difficultyBase, equipment
- `Modifier` (부수 규칙/미션/제약)
  - id, type(예: 벌칙/미션/제약/점수/공간), name, ruleText, sportAllow, locationAllow, equipmentNeeded, difficultyDelta, timeDelta
- `Template` (출력 템플릿)
  - 후보카드 문장/수업안(도입-전개-정리) 렌더링 템플릿

### 3-3. “모듈 셔플”을 안전하게 돌리는 규칙(중요)
- **셔플은 “랜덤”이 아니라 “제약 만족 퍼즐”**로 다루는 게 맞습니다.
- 최소 가드레일(추천):
  1) 안전/과격 미션은 난이도·학년·공간 조건으로 자동 제한  
  2) 장비 미보유 시 해당 모듈 자동 제외  
  3) CoreRule 위반 모듈은 절대 결합 금지(예: ‘발 사용 금지’ 같은 게 축구 핵심과 충돌하면 폐기)
  4) 수업 흐름 상 “도입-전개-정리”에서 과도한 변형은 전개 2~3에 집중

> 실없는 농담 1줄:  
> 모듈 셔플은 “체육 수업 DJ 믹스”입니다.  
> 근데 학생이 춤추다 다치면 DJ가 책임져야 하니, 믹서에 안전 리미터를 꼭 달아야 합니다.

---

## 4) 모듈식 구성안 예시(선생님 예시 기반)

### 4-1. 원형(축구) — 공차기/멈추기 + 패스
- **FMS 포커스**: 차기, 볼 멈추기, 달리기  
- **Atom**: “대장 순환 패스(역할 교대)”  
- **CoreRule(축구)**: 발로만 컨트롤, 손 사용 제한  
- **차시 구성(예시)**  
  - 1차시: 2인 1조 차고-멈추기(거리/각도 단계화)  
  - 2차시: 대장패스(대장 존에서 교대하며 패스 반복)  
  - 3차시: 대장패스 스피드(시간 제한/성공 횟수/미션 결합)

### 4-2. 이식(농구) — 공던지기/받기 + 패스
- 불변: “대장/순환/교대/성공 미션” 구조(Atom)
- 변경: 패스 수단(손), 바운드 패스/체스트 패스 등 종목기술 강조(CoreRule/SkillSet)
- 결과: “대장 패스(던지고-받기)”로 자연스럽게 변환

### 4-3. 셔플 융합 예시(얼음땡 + 드리블 + 스쿼트)
- Atom: 얼음땡(술래/도망/잡힘)
- Atom(혹은 Skill Constraint): 드리블 유지
- Modifier: 잡히면 스쿼트 3회(벌칙/미션)
- 축구 버전: “드리블 얼음땡 + 잡히면 스쿼트”
- 농구 버전: “드리블 얼음땡(손) + 잡히면 스쿼트”

---

## 5) Firebase Genkit + 벡터DB + RAG로 붙이는 방법(현실적인 설계)

### 결론부터
- **된다.** 오히려 이 프로젝트에 딱 맞다.
- 단, 권장 구조는 이렇다:
  1) 기존 “컴파일러(Atom+Modifier)”는 계속 사용(신뢰성/안전/재현성 담당)
  2) Genkit+RAG는
     - (a) 모듈/자료 검색(새로운 아이디어 발굴)  
     - (b) 설명/수업안 문장화  
     - (c) 학급 맥락 맞춤(수준·장비·공간·인원·날씨)  
     를 담당

### 5-1. 데이터/벡터 저장소
- Firestore에 **문서(모듈/활동/자료)** 저장
- 각 문서에 `embedding` 필드(벡터) 저장 + KNN 인덱스 생성
- “문서가 수정/추가될 때 자동 임베딩”은 Firebase Extension으로 자동화 가능(선택)

### 5-2. RAG 플로우(Genkit)
- 입력: 학년/종목/장소/인원/도구/수업목표(FMS)/시간/특이사항
- 단계:
  1) 메타 필터(grade, sport, location 등)로 후보군 축소
  2) 벡터 검색으로 유사 모듈/수업안/게임 규칙 문서 Top-k 검색
  3) (옵션) 기존 컴파일러로 Atom+Modifier 조합 후보도 생성
  4) LLM이 “추천 3안 + 차시 구성 + 안전/지도 포인트 + 평가 포인트”로 정리

### 5-3. 프론트(React)에서 연결
- React 앱은 **Genkit Flow(Cloud Function)** 를 호출해서 결과를 받음
- 결과는 “카드 + 수업 확정 저장” UX로 현재 `SketchPage` 구조와 그대로 결합 가능

### 5-4. RAG의 지식 소스(선생님이 올린 PDF 포함)
- 업로드한 자료(PDF)를 “활동/규칙/미션” 단위로 쪼개서 문서화 → 임베딩 → Firestore 저장  
- 이렇게 하면,  
  - ‘대장패스’ 같은 활동이 아직 Atom으로 등록되지 않았어도,  
  - **자료집에서 유사 규칙을 찾아** Atom/Modifier 후보로 추출하는 흐름이 가능해짐.

---

## 6) 다음 액션 체크리스트 (추천 순서)

1. **스키마 확정**: Atom/Modifier/CoreRule/FMS/Template  
2. **자료 정리**:  
   - 기존 `activityAtoms.json`, `ruleModifiers.json` 정리/확장  
   - “대장패스” 같은 대표 활동을 Atom으로 추가
3. **문서화 파이프라인**(PDF → chunk → 문서 → 임베딩):  
   - 1차는 수동(스프레드시트/JSON)로 시작해도 OK  
4. **Genkit Flow 1개만 먼저**:  
   - “조건 → 벡터검색 → 추천 3개 생성”까지
5. **UI 연결**:  
   - `SketchPage`의 “후보 다시 생성” 버튼을 Flow 호출로 교체  
6. **검증/안전 룰 강화**:  
   - 위험 요소 모듈(과격 벌칙 등) 자동 제한 규칙 추가

---

## 부록 A) 참고 파일(선생님 업로드 자료)
- `[별책11]체육과교육과정(2022개정).pdf`
- `(동아출판) 체육 게임 & 표현 활동 자료집.pdf`
- `비와 미세먼지 걱정 없는 실내 체육 16차시 03.36.53.pdf`
- `즐겁고 신나는 베스트 술래 게임 20 03.36.53.pdf`

